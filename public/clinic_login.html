<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Clinic Login</title>
  <script src="/js/branding_config.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    
    :root {
      --primary: #10b981;
      --primary-hover: #059669;
      --primary-light: rgba(16, 185, 129, 0.1);
      --secondary: #6366f1;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --bg: #f8fafc;
      --surface: #ffffff;
      --text: #1e293b;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --shadow: 0 1px 3px rgba(0,0,0,0.08);
      --shadow-lg: 0 4px 20px rgba(0,0,0,0.08);
      --radius: 12px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg);
      min-height: 100vh;
      line-height: 1.5;
    }

    /* Navigation */
    .header {
      background: var(--surface);
      padding: 0.75rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      text-decoration: none;
    }

    .logo-icon {
      height: 36px;
      width: auto;
      border-radius: 8px;
    }

    .logo-text {
      font-weight: 700;
      font-size: 1.25rem;
      background: linear-gradient(135deg, #2563eb 0%, #0891b2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .logo-tagline { font-size: 0.7rem; color: #2563eb; font-weight: 500; letter-spacing: 0.02em; }

    .nav-link {
      font-size: 0.8125rem;
      font-weight: 600;
      color: white;
      text-decoration: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      transition: all 0.2s;
      background: linear-gradient(135deg, #0d9488 0%, #14b8a6 100%);
    }

    .nav-link:hover { background: linear-gradient(135deg, #0f766e 0%, #0d9488 100%); box-shadow: 0 4px 12px rgba(13, 148, 136, 0.3); }

    /* Main Container */
    .main {
      max-width: 520px;
      margin: 0 auto;
      padding: 1.5rem;
    }

    .login-container {
      width: 100%;
    }

    .card {
      background: var(--surface);
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
      overflow: hidden;
    }

    .card-header {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      padding: 1.25rem;
      border-bottom: 1px solid #93c5fd;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .card-header-icon {
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
    }

    .card-header-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: #1e40af;
    }

    .card-header-subtitle {
      font-size: 0.8125rem;
      color: #1e3a8a;
    }

    .card-body {
      padding: 1.5rem;
    }

    /* Form Styles */
    .form-card {
      background: var(--surface);
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
      overflow: hidden;
    }

    .tabs {
      display: none;
      gap: 0;
      margin-bottom: 1.5rem;
      background: transparent;
      padding: 0;
      border-radius: 0;
      border-bottom: 2px solid var(--border);
    }

    .tab {
      flex: 1;
      padding: 0.75rem 1.5rem;
      border: none;
      background: transparent;
      font-size: 0.9375rem;
      font-weight: 600;
      color: var(--text-muted);
      cursor: pointer;
      border-radius: 0;
      transition: all 0.2s;
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
    }

    .tab.active {
      background: transparent;
      color: var(--primary);
      box-shadow: none;
      border-bottom-color: var(--primary);
    }

    .tab:hover:not(.active) {
      color: var(--text);
    }

    .tab-content {
      display: none !important;
    }

    .tab-content.active {
      display: block !important;
    }

    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 0.5rem;
    }

    .form-input {
      width: 100%;
      padding: 0.875rem 1rem;
      font-size: 1rem;
      border: 2px solid var(--border);
      border-radius: 10px;
      background: var(--surface);
      color: var(--text);
      transition: all 0.2s;
      -webkit-appearance: none;
      appearance: none;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--primary-light);
    }

    .form-input::placeholder { color: #94a3b8; }

    .form-input:disabled {
      background: #f8fafc;
      color: #94a3b8;
      cursor: not-allowed;
    }

    .btn {
      width: 100%;
      padding: 0.875rem 1.5rem;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      color: white;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-outline {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text);
    }

    .btn-outline:hover {
      background: var(--bg);
    }

    .link-text {
      text-align: center;
      margin-top: 1rem;
      font-size: 0.875rem;
      color: var(--text-light);
    }

    .link {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
    }

    .link:hover {
      text-decoration: underline;
    }

    .divider {
      text-align: center;
      margin: 1.5rem 0;
      color: var(--text-light);
      font-size: 0.875rem;
      position: relative;
    }

    .divider::before,
    .divider::after {
      content: '';
      position: absolute;
      top: 50%;
      width: 40%;
      height: 1px;
      background: var(--border);
    }

    .divider::before { left: 0; }
    .divider::after { right: 0; }

    .alert {
      padding: 0.875rem 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-size: 0.875rem;
      display: none;
    }

    .alert.show {
      display: block;
    }

    .alert-error {
      background: #fef2f2;
      color: #dc2626;
      border: 1px solid #fecaca;
    }

    .alert-success {
      background: #f0fdf4;
      color: #059669;
      border: 1px solid #86efac;
    }

    /* Hidden utility */
    .hidden {
      display: none !important;
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 1.5rem;
      color: var(--text-muted);
      font-size: 0.8125rem;
    }

    .footer a {
      color: var(--primary);
      text-decoration: none;
    }

    .footer a:hover {
      text-decoration: underline;
    }

    /* Responsive */
    @media (max-width: 480px) {
      .form-card {
        padding: 2rem 1.5rem;
      }

      .login-title {
        font-size: 1.625rem;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <a href="/" class="logo">
      <img src="/asset/logo/doctor_logo.png" alt="App Logo" class="logo-icon" />
      <div>
        <div class="logo-text">Loading...</div>
        <div class="logo-tagline">Loading...</div>
      </div>
    </a>
    <a href="/" class="nav-link">Home</a>
  </header>

  <!-- Main Content -->
  <main class="main">
    <div class="login-container">
      <!-- Form Card -->
      <div class="form-card">
        <!-- Card Header -->
        <div class="card-header">
          <div class="card-header-icon">üè•</div>
          <div>
            <div class="card-header-title">Clinic Login</div>
            <div class="card-header-subtitle">Manage your clinic</div>
          </div>
        </div>

        <div class="card-body">
        <!-- Tabs -->
        <div class="tabs">
          <button class="tab active" onclick="showTab('signin')">Sign In</button>
          <button class="tab" onclick="showTab('signup')">Start Free Trial</button>
        </div>

      <!-- Alert Messages -->
      <div id="alertBox" class="hidden"></div>

      <!-- Sign In Tab -->
      <div id="signin" class="tab-content active">
        <form id="signinForm">
          <div class="form-group">
            <label class="form-label">Clinic ID</label>
            <input type="text" name="clinic_id" class="form-input" placeholder="Enter your clinic ID" required />
          </div>
          <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" name="password" class="form-input" placeholder="Enter your password" required />
          </div>
          <button type="submit" class="btn btn-primary">Sign In</button>
        </form>
        <p class="link-text">
          <a href="#" class="link" onclick="showTab('forgot'); return false;">Forgot password?</a>
        </p>
      </div>

      <!-- Start Free Trial Tab -->
      <div id="signup" class="tab-content">
        <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border: 1px solid #86efac; border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem; text-align: center;">
          <div style="font-size: 1.5rem; margin-bottom: 0.25rem;">üéâ</div>
          <div style="font-weight: 600; color: #065f46; margin-bottom: 0.25rem;">30-Day Free Trial</div>
          <div style="font-size: 0.75rem; color: #059669;">No credit card required ‚Ä¢ Full access to all features</div>
        </div>
        
        <form id="signupForm">
          <div class="form-group">
            <label class="form-label">Clinic Name *</label>
            <input type="text" name="name" class="form-input" placeholder="Your clinic name" required minlength="3" title="Clinic name must be at least 3 characters" />
          </div>
          <div class="form-group">
            <label class="form-label">Contact Person *</label>
            <input type="text" name="owner_name" class="form-input" placeholder="Dr. / Owner name" required minlength="3" title="Contact person name must be at least 3 characters" />
          </div>
          <div class="form-group">
            <label class="form-label">Phone Number *</label>
            <input type="tel" name="phone" class="form-input" placeholder="10-digit mobile number" required pattern="[0-9]{10}" maxlength="10" inputmode="numeric" title="Please enter exactly 10 digits" />
          </div>
          <div class="form-group">
            <label class="form-label">Email *</label>
            <input type="email" name="email" class="form-input" placeholder="your@email.com" required pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}" title="Please enter a valid email" />
          </div>
          <div class="form-group">
            <label class="form-label">City/Location *</label>
            <input type="text" name="address" class="form-input" placeholder="City, State" required />
          </div>
          <div class="form-group">
            <label class="form-label">Clinic Logo</label>
            <input type="file" name="logo" id="signupLogo" class="form-input" accept="image/png,image/jpeg,image/jpg" />
            <div style="font-size: 0.75rem; color: #64748b; margin-top: 0.25rem;">Optional - Logo will appear on prescriptions</div>
          </div>
          <div class="form-group">
            <label class="form-label">Password *</label>
            <input type="password" name="password" class="form-input" placeholder="Minimum 6 characters" required minlength="6" />
          </div>
          <div class="form-group">
            <label class="form-label">Confirm Password *</label>
            <input type="password" name="confirm_password" class="form-input" placeholder="Re-enter password" required minlength="6" />
          </div>
          <button type="submit" class="btn btn-primary">Start Free Trial ‚Üí</button>
        </form>
        <p class="link-text" style="margin-top: 1rem; font-size: 0.8125rem; color: var(--text-muted);">
          Already have an account? <a href="#" class="link" onclick="showTab('signin'); return false;">Sign In</a>
        </p>
      </div>

      <!-- Forgot Password Tab (Hidden by default) -->
      <div id="forgot" class="tab-content">
        <h3 style="margin-bottom: 1rem; font-size: 1.125rem; font-weight: 600;">Reset Password</h3>
        
        <!-- Alert Box -->
        <div id="forgotAlertBox" class="alert" style="display: none;"></div>

        <!-- Step 1: Enter Clinic ID -->
        <div id="forgotStep1">
          <p style="color: var(--text-muted); font-size: 0.875rem; margin-bottom: 1.5rem;">
            Enter your Clinic ID. We'll send an OTP to your registered phone number.
          </p>
          <form id="forgotForm1" onsubmit="handleForgotStep1(event)">
            <div class="form-group">
              <label class="form-label">Clinic ID *</label>
              <input type="text" id="forgotClinicId" class="form-input" placeholder="Enter your Clinic ID" required />
            </div>
            <button type="submit" class="btn btn-primary">Send OTP</button>
            <button type="button" class="btn btn-outline" onclick="resetForgotPassword(); showTab('signin')" style="margin-top: 0.75rem;">Back to Sign In</button>
          </form>
        </div>

        <!-- Step 2: Enter OTP -->
        <div id="forgotStep2" style="display: none;">
          <p style="color: var(--text-muted); font-size: 0.875rem; margin-bottom: 1rem;">
            OTP sent to <strong id="maskedEmail"></strong>
          </p>
          <form id="forgotForm2" onsubmit="handleForgotStep2(event)">
            <div class="form-group">
              <label class="form-label">Enter OTP *</label>
              <input type="text" id="otpInput" class="form-input" placeholder="6-digit OTP" maxlength="6" pattern="[0-9]{6}" title="OTP must be exactly 6 digits" required />
            </div>
            <button type="submit" class="btn btn-primary">Verify OTP</button>
            <button type="button" class="btn btn-outline" onclick="resetForgotPassword()" style="margin-top: 0.75rem;">Back</button>
          </form>
          <p style="color: var(--text-muted); font-size: 0.75rem; margin-top: 1rem;">
            Didn't receive OTP? <a href="#" class="link" onclick="resendOTP(); return false;">Resend</a>
          </p>
        </div>

        <!-- Step 3: Set New Password -->
        <div id="forgotStep3" style="display: none;">
          <p style="color: var(--text-muted); font-size: 0.875rem; margin-bottom: 1.5rem;">
            OTP verified! Now set your new password.
          </p>
          <form id="forgotForm3" onsubmit="handleForgotStep3(event)">
            <div class="form-group">
              <label class="form-label">New Password *</label>
              <input type="password" id="newPassword" class="form-input" placeholder="Enter new password" required minlength="6" />
            </div>
            <div class="form-group">
              <label class="form-label">Confirm Password *</label>
              <input type="password" id="confirmPassword" class="form-input" placeholder="Re-enter new password" required minlength="6" />
            </div>
            <button type="submit" class="btn btn-primary">Reset Password</button>
          </form>
        </div>
        </div>
      </div>
    </div>

    <div class="footer">
      <p>Need help? <a href="/index.html">Contact Support</a></p>
    </div>
    </div>
  </main>

  <script>
    // Tab switching
    function showTab(tabName) {
      // Hide all tabs and deactivate buttons
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
      
      // Show selected tab
      const tab = document.getElementById(tabName);
      if (tab) tab.classList.add('active');
      
      // Activate corresponding button (for signin/signup only)
      if (tabName === 'signin' || tabName === 'signup') {
        const buttons = document.querySelectorAll('.tab');
        if (tabName === 'signin') buttons[0].classList.add('active');
        if (tabName === 'signup') buttons[1].classList.add('active');
      }
      
      // Clear alerts
      hideAlert();
    }

    // Check URL parameters on page load
    window.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const mode = urlParams.get('mode');
      
      const tabs = document.querySelectorAll('.tabs .tab');
      const signinTab = tabs[0]; // Sign In button
      const signupTab = tabs[1]; // Start Free Trial button
      
      if (mode === 'trial') {
        // Hide Sign In tab, show only Trial
        signinTab.style.display = 'none';
        signupTab.style.display = 'block';
        showTab('signup');
      } else if (mode === 'login') {
        // Hide Trial tab, show only Sign In
        signinTab.style.display = 'block';
        signupTab.style.display = 'none';
        showTab('signin');
      }
      // If no mode, show both tabs (default behavior)
    });

    // Alert functions
    function showAlert(message, type = 'error') {
      const alertBox = document.getElementById('alertBox');
      alertBox.className = `alert alert-${type}`;
      alertBox.textContent = message;
      alertBox.style.display = 'block';
    }

    function hideAlert() {
      const alertBox = document.getElementById('alertBox');
      if (alertBox) alertBox.style.display = 'none';
    }

    function showForgotAlert(message, type = 'error') {
      const alertBox = document.getElementById('forgotAlertBox');
      alertBox.className = `alert alert-${type}`;
      alertBox.textContent = message;
      alertBox.style.display = 'block';
    }

    function hideForgotAlert() {
      const alertBox = document.getElementById('forgotAlertBox');
      if (alertBox) alertBox.style.display = 'none';
    }

    // Forgot Password Flow
    let forgotPasswordData = {
      clinicId: null,
      otpToken: null
    };

    function resetForgotPassword() {
      // Reset all steps
      document.getElementById('forgotStep1').style.display = 'block';
      document.getElementById('forgotStep2').style.display = 'none';
      document.getElementById('forgotStep3').style.display = 'none';
      
      // Clear all forms
      document.getElementById('forgotForm1').reset();
      document.getElementById('forgotForm2').reset();
      document.getElementById('forgotForm3').reset();
      
      // Clear data
      forgotPasswordData = { clinicId: null, otpToken: null };
      hideForgotAlert();
    }

    async function handleForgotStep1(e) {
      e.preventDefault();
      hideForgotAlert();
      
      const clinicId = document.getElementById('forgotClinicId').value.trim();
      
      try {
        const res = await fetch('/clinic/forgot-password/send-otp', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ clinic_id: clinicId })
        });
        const result = await res.json();
        
        if (result.success) {
          forgotPasswordData.clinicId = clinicId;
          document.getElementById('maskedEmail').textContent = result.maskedEmail;
          
          // Move to step 2
          document.getElementById('forgotStep1').style.display = 'none';
          document.getElementById('forgotStep2').style.display = 'block';
          
          showForgotAlert(`OTP sent to ${result.maskedEmail}`, 'success');
        } else {
          showForgotAlert(result.message || 'Failed to send OTP', 'error');
        }
      } catch (error) {
        showForgotAlert('Network error. Please try again.', 'error');
      }
    }

    async function handleForgotStep2(e) {
      e.preventDefault();
      hideForgotAlert();
      
      const otp = document.getElementById('otpInput').value.trim();
      
      try {
        const res = await fetch('/clinic/forgot-password/verify-otp', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            clinic_id: forgotPasswordData.clinicId,
            otp: otp 
          })
        });
        const result = await res.json();
        
        if (result.success) {
          forgotPasswordData.otpToken = result.token;
          
          // Move to step 3
          document.getElementById('forgotStep2').style.display = 'none';
          document.getElementById('forgotStep3').style.display = 'block';
          
          showForgotAlert('OTP verified! Set your new password.', 'success');
        } else {
          showForgotAlert(result.message || 'Invalid OTP', 'error');
        }
      } catch (error) {
        showForgotAlert('Network error. Please try again.', 'error');
      }
    }

    async function handleForgotStep3(e) {
      e.preventDefault();
      hideForgotAlert();
      
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      
      if (newPassword !== confirmPassword) {
        showForgotAlert('Passwords do not match', 'error');
        return;
      }
      
      if (newPassword.length < 6) {
        showForgotAlert('Password must be at least 6 characters', 'error');
        return;
      }
      
      try {
        const res = await fetch('/clinic/forgot-password/reset', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            clinic_id: forgotPasswordData.clinicId,
            token: forgotPasswordData.otpToken,
            new_password: newPassword 
          })
        });
        const result = await res.json();
        
        if (result.success) {
          showForgotAlert('Password reset successful! Redirecting to login...', 'success');
          setTimeout(() => {
            resetForgotPassword();
            showTab('signin');
          }, 2000);
        } else {
          showForgotAlert(result.message || 'Failed to reset password', 'error');
        }
      } catch (error) {
        showForgotAlert('Network error. Please try again.', 'error');
      }
    }

    async function resendOTP() {
      hideForgotAlert();
      
      try {
        const res = await fetch('/clinic/forgot-password/send-otp', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ clinic_id: forgotPasswordData.clinicId })
        });
        const result = await res.json();
        
        if (result.success) {
          showForgotAlert('OTP resent successfully!', 'success');
        } else {
          showForgotAlert(result.message || 'Failed to resend OTP', 'error');
        }
      } catch (error) {
        showForgotAlert('Network error. Please try again.', 'error');
      }
    }

    // Sign In Form
    document.getElementById('signinForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      hideAlert();
      
      const formData = new FormData(e.target);
      const data = {
        clinic_id: formData.get('clinic_id'),
        password: formData.get('password')
      };
      
      try {
        const res = await fetch('/clinic/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        
        if (result.success) {
          // Redirect immediately without showing message
          window.location.href = '/clinic_home.html';
        } else {
          showAlert(result.message || 'Invalid credentials');
        }
      } catch (error) {
        showAlert('Connection error. Please try again.');
      }
    });

    // Start Free Trial Form
    document.getElementById('signupForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      hideAlert();
      
      const formElement = e.target;
      const formData = new FormData(formElement);
      const password = formData.get('password');
      const confirmPassword = formData.get('confirm_password');
      
      // Password validation
      if (password !== confirmPassword) {
        showAlert('Passwords do not match');
        return;
      }
      
      if (password.length < 6) {
        showAlert('Password must be at least 6 characters');
        return;
      }
      
      // Remove confirm_password before sending
      formData.delete('confirm_password');
      
      try {
        const res = await fetch('/clinic/signup', {
          method: 'POST',
          body: formData  // Send as FormData to include logo file
        });
        const result = await res.json();
        
        if (result.success) {
          // Create modal overlay with profile completion
          const modalHTML = `
            <div id="successModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 9999; padding: 1rem;">
              <div style="background: white; border-radius: 16px; max-width: 550px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);">
                
                <!-- Success Header -->
                <div style="padding: 2rem 2rem 1rem 2rem; text-align: center; border-bottom: 1px solid #e2e8f0;">
                  <div style="font-size: 3rem; margin-bottom: 0.5rem;">üéâ</div>
                  <h2 style="color: #059669; margin-bottom: 0.5rem; font-size: 1.375rem; font-weight: 700;">Account Created!</h2>
                  
                  <!-- Clinic ID Box -->
                  <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border: 2px solid #86efac; border-radius: 10px; padding: 1rem; margin-top: 1rem;">
                    <div style="font-size: 0.75rem; color: #065f46; margin-bottom: 0.5rem; font-weight: 600;">Your Clinic ID</div>
                    <div style="font-size: 1.5rem; font-weight: bold; color: #059669; font-family: monospace; letter-spacing: 2px; word-break: break-all;">${result.clinic_id}</div>
                    <div style="font-size: 0.6875rem; color: #059669; margin-top: 0.5rem;">üíæ Save this ID - you'll need it to login</div>
                  </div>
                </div>
                
                <!-- Profile Completion Form -->
                <div style="padding: 1.5rem 2rem 2rem 2rem;">
                  <div style="background: #fef3c7; border: 1px solid #fbbf24; border-radius: 8px; padding: 0.875rem; margin-bottom: 1.25rem; font-size: 0.8125rem; color: #92400e;">
                    <div style="font-weight: 600; margin-bottom: 0.25rem;">ÔøΩ Setup Payment Details</div>
                    <div>Add UPI ID & QR code to receive payments from patients</div>
                  </div>
                  
                  <form id="completeProfileForm">
                    <div style="margin-bottom: 1rem;">
                      <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #334155; margin-bottom: 0.375rem;">Full Address (Optional)</label>
                      <textarea id="fullAddress" style="width: 100%; padding: 0.625rem; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 0.875rem; font-family: inherit; resize: vertical; min-height: 70px;" placeholder="Complete clinic address with landmark">${result.address || ''}</textarea>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                      <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #334155; margin-bottom: 0.375rem;">üí≥ UPI ID (Recommended)</label>
                      <input type="text" id="upiId" style="width: 100%; padding: 0.625rem; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 0.875rem;" placeholder="yourname@paytm or 9876543210@phonepe" />
                      <small style="color: #64748b; font-size: 0.75rem;">üí° Patients can pay consultation fees directly to you</small>
                    </div>
                    
                    <div style="margin-bottom: 1.25rem;">
                      <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #334155; margin-bottom: 0.375rem;">üì± Payment QR Code (Recommended)</label>
                      <input type="file" id="qrCode" accept="image/png,image/jpeg,image/jpg" style="width: 100%; padding: 0.5rem; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 0.875rem;" />
                      <small style="color: #64748b; font-size: 0.75rem;">üí° Upload your UPI QR code - patients can scan & pay (PNG/JPG)</small>
                    </div>
                    
                    <div style="font-size: 0.8125rem; color: #059669; margin-bottom: 1rem; line-height: 1.6; padding: 0.75rem; background: #f0fdf4; border-radius: 6px;">
                      ‚úÖ 30-day free trial activated<br>
                      üéØ Full access to all features
                    </div>
                    
                    <div style="display: flex; gap: 0.75rem;">
                      <button type="button" onclick="window.location.href='/clinic_home.html'" style="flex: 1; background: white; color: #64748b; border: 1px solid #cbd5e1; padding: 0.75rem; border-radius: 8px; font-size: 0.875rem; font-weight: 600; cursor: pointer;">
                        Skip for Now
                      </button>
                      <button type="submit" style="flex: 1; background: linear-gradient(135deg, #059669 0%, #047857 100%); color: white; border: none; padding: 0.75rem; border-radius: 8px; font-size: 0.875rem; font-weight: 600; cursor: pointer;">
                        Save Payment Info ‚Üí
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          `;
          
          // Add modal to page
          document.body.insertAdjacentHTML('beforeend', modalHTML);
          
          // Handle profile completion form
          document.getElementById('completeProfileForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const fullAddress = document.getElementById('fullAddress').value.trim();
            const upiId = document.getElementById('upiId').value.trim();
            const qrCodeFile = document.getElementById('qrCode').files[0];
            
            try {
              const formData = new FormData();
              if (fullAddress) formData.append('address', fullAddress);
              if (upiId) formData.append('upi_id', upiId);
              if (qrCodeFile) formData.append('qr_image', qrCodeFile);
              
              // Only update if there's something to update
              if (fullAddress || upiId || qrCodeFile) {
                const res = await fetch('/clinic/update-profile', {
                  method: 'POST',
                  body: formData,
                  credentials: 'include'
                });
                
                const data = await res.json();
                if (!data.success) {
                  console.warn('Profile update failed:', data.message);
                }
              }
              
              // Redirect to dashboard
              window.location.href = '/clinic_home.html';
            } catch (error) {
              console.error('Profile completion error:', error);
              // Still redirect even if profile update fails
              window.location.href = '/clinic_home.html';
            }
          });
        } else {
          showAlert(result.message || 'Failed to create account');
        }
      } catch (error) {
        showAlert('Connection error. Please try again.');
      }
    });
  </script>
  <script src="/js/brandingConfigLoader.js"></script>
</body>
</html>
